# BC-macro 활용 가이드

## 1. 설치 및 설정

### 필수 요구사항
- EMME 소프트웨어 (버전 4.0 이상 권장)
- 교통 네트워크 데이터
- 통행수요 매트릭스 (O-D 매트릭스)
- VDF (Volume-Delay Function) 설정

### 매크로 파일 설치
1. BC-macro 폴더를 EMME 프로젝트 디렉토리에 복사
2. EMME 매크로 경로에 BC-macro 폴더 추가
3. 권한 설정 확인

## 2. 기본 사용법

### 2.1 단일 시나리오 분석

**목적**: 특정 연도의 편익을 계산

```emme
// 시나리오 71029를 이용한 2029년 편익 분석
~<BC-mac\+bc-1.mac 71029
```

**실행 결과**:
- 시나리오 71029에서 교통배정 수행
- 각종 편익 계산 (VOCS, VOTS, VICS, VOPCS, VONCS)
- Benefit71029 파일 생성

### 2.2 다중 연도 분석

**목적**: 2029-2045년 기간의 편익 분석

```emme
// 시나리오 번호 7, 요금정책 Fare30.mac 적용
~t1=7
~t3=Fare30.mac
~<BC-mac\+bc-st.mac
```

**실행 과정**:
1. 기준 시나리오 (예: 71029) 생성
2. 2030, 2035, 2040, 2045년 시나리오 복사
3. 각 연도별 교통배정 및 편익 계산
4. 연도별 결과 파일 생성

### 2.3 개별 편익 계산

**특정 시나리오만 편익 계산**:
```emme
// 시나리오 71035에 대해서만 편익 계산
~<BC-mac\Benefit.mac 71035
```

## 3. 실무 활용 사례

### 사례 1: 고속도로 신설 프로젝트

**배경**: A-B 구간 고속도로 신설의 경제성 평가

**분석 절차**:
```emme
// 1단계: 기준 시나리오 (현재상황) 설정
~<copyscen y 1000 71029 "2029 Without Project"

// 2단계: 프로젝트 시나리오 생성
~<copyscen y 71029 72029 "2029 With Project"
// (고속도로 링크 추가 및 용량 설정)

// 3단계: 편익 분석 실행
~t1=7
~<BC-mac\+bc-st.mac

// 4단계: 결과 검토
// Benefit71029 (기준) vs Benefit72029 (프로젝트) 비교
```

**예상 결과**:
- 시간가치 편익: 통행시간 단축으로 인한 편익
- 차량운행비용 편익: 연료비 및 운행비 절약
- 사고비용 편익: 안전도 향상으로 인한 편익

### 사례 2: 대중교통 요금정책 분석

**배경**: 지하철 요금 인하 정책의 효과 분석

**분석 절차**:
```emme
// 1단계: 현재 요금 시나리오
~<BC-mac\ResultBC.mac 81029 51 CurrentFare.mac

// 2단계: 요금인하 시나리오  
~<BC-mac\ResultBC.mac 82029 52 ReducedFare.mac

// 3단계: 편익 비교
~<BC-mac\Benefit.mac 81029
~<BC-mac\Benefit.mac 82029
```

### 사례 3: 도시개발사업 교통영향 평가

**배경**: 신도시 개발에 따른 교통편익 분석

**분석 절차**:
```emme
// 1단계: 개발 전 시나리오
~<BC-mac\+bc-1.mac 91029

// 2단계: 개발 후 교통량 증가 반영
// (O-D 매트릭스 수정 후)
~<BC-mac\+bc-1.mac 92029

// 3단계: 추가 도로인프라 반영
~<BC-mac\+bc-1.mac 93029

// 4단계: 단계별 편익 비교
```

## 4. 고급 활용

### 4.1 매개변수 조정

**시간가치 조정** (Benefit.mac 내):
```emme
// 승용차 시간가치를 25,000원으로 변경
~r1%*25000  // 기존: 23319
```

**사고비용 원단위 조정**:
```emme
// 고속도로 사고비용을 20원/(대·km)로 변경
20*(@rcl.eq.1)*@totv*len  // 기존: 19.7765788704
```

### 4.2 선택적 편익 계산

**특정 도로등급만 분석**:
```emme
// 고속도로만 편익 계산
~+;2.41;1;n;@vots;;!@lmark=0&ci=0&cj=0&!@totv=0&@rcl=1;;2;2;6
```

**특정 지역만 분석**:
```emme
// @lmark=1인 링크만 편익 계산  
~+;2.41;1;n;@vots;;@lmark=1&ci=0&cj=0&!@totv=0;;2;2;6
```

### 4.3 결과 집계 및 분석

**전체 네트워크 편익 합계**:
```emme
// 매트릭스로 편익 합계 추출
~+;2.41;1;n;@vots;;ci=0&cj=0&!@totv=0;;2;2;6
```

## 5. 문제해결 가이드

### 5.1 일반적인 오류

**오류**: "Cannot create extra attribute"
**해결**: 기존 속성 삭제 후 재실행
```emme
~+;3;@vots;~?e; ;~?q=1;y  // 속성 삭제
```

**오류**: 교통배정 미수렴
**해결**: 반복횟수 증가 및 수렴기준 완화
```emme
~r180=200        // 반복횟수 100→200 증가
~r182=0.00001    // 상대갭 기준 완화
```

### 5.2 결과 검증

**교통량 확인**:
```emme
// 주요 링크의 교통량 변화 확인
~+;2.41;1;n;@totv;;length>5&vdf<10;;2;1;6
```

**속도 확인**:
```emme
// 비현실적인 속도값 확인 
~+;2.41;1;n;@pspd;;@pspd>150|@pspd<10;;2;1;6
```

## 6. 성능 최적화

### 6.1 대용량 네트워크 처리

**메모리 관리**:
```emme
// 불필요한 속성 삭제
~<delextra @temp1 @temp2 @temp3

// 배치 처리 방식 사용
~<BC-mac\Benefit.mac 71029 &
~<BC-mac\Benefit.mac 71030 &
~<BC-mac\Benefit.mac 71035 &
```

### 6.2 계산 시간 단축

**병렬 처리**:
- 연도별 시나리오를 별도 세션에서 동시 실행
- 지역별로 네트워크 분할하여 처리

**선택적 계산**:
- 중요도가 낮은 편익 항목 제외
- 분석 대상 링크 제한 (@lmark 활용)

## 7. 결과 해석 가이드

### 7.1 편익 규모 평가

**일반적인 편익 크기 순서**:
1. 시간가치 편익 (VOTS) - 가장 큰 비중
2. 차량운행비용 편익 (VOCS) - 두 번째 큰 비중  
3. 사고비용 편익 (VICS) - 중간 비중
4. 대기오염비용 편익 (VOPCS) - 작은 비중
5. 소음비용 편익 (VONCS) - 가장 작은 비중

### 7.2 결과 검토 포인트

**합리성 검토**:
- 편익이 음수인 링크 확인 (용량 부족으로 인한 지체 증가)
- 비현실적으로 큰 편익값 확인
- 기준/프로젝트 시나리오 간 논리적 일관성

**민감도 분석**:
- 시간가치 ±20% 변동
- 교통량 ±10% 변동  
- 프로젝트 개통시기 변경

이 가이드를 통해 BC-macro를 효과적으로 활용하여 교통 프로젝트의 경제성을 정확하게 평가할 수 있습니다.