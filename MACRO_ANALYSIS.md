# BC-macro 상세 분석 문서

## 1. Benefit.mac - 메인 편익 계산 매크로

### 기능
교통 프로젝트의 경제적 편익을 종합적으로 계산하는 핵심 매크로입니다.

### 주요 계산 항목

#### 1.1 차량운행비용 (Vehicle Operating Cost Saving, VOCS)
```
공식: 4차 다항식 함수
VOCS = (a₄×speed⁴ + a₃×speed³ + a₂×speed² + a₁×speed + a₀) × 거리 × 교통량 × 차종비율
```

**차종별 계수 (2024년 기준)**:
- 승용차(r1=0.786701): 주행비용이 가장 낮음
- 버스(r2=0.003427): 높은 운행비용, 낮은 비율
- 소형화물차(r3=0.154045): 중간 수준 비용
- 중형화물차(r4=0.029522): 높은 비용, 낮은 비율  
- 대형화물차(r5=0.026303): 가장 높은 비용

#### 1.2 시간가치 (Value of Travel Time Saving, VOTS)
```
VOTS = (통행시간/60) × 교통량 × 시간가치 × 365일 / 1억
```

**시간가치 (2024년 KDI 기준)**:
- 승용차: 23,319원/시간
- 버스: 191,626원/시간  
- 화물차: 27,809원/시간

#### 1.3 교통사고비용 (Vehicle Incident Cost Saving, VICS)
```
VICS = 도로등급별_사고비용_원단위 × 교통량 × 거리 × 365일 / 1억
```

**도로등급별 사고비용**:
- 고속도로(@rcl=1): 19.78원/(대·km)
- 국도(@rcl=2): 58.96원/(대·km)
- 지방도(@rcl=3): 153.73원/(대·km)

#### 1.4 대기오염비용 (Valuation of Pollution Cost Saving, VOPCS)
속도에 따른 배출계수 변화를 고려한 4차 다항식:
```
VOPCS = (배출계수_함수) × 거리 × 교통량 × 차종비율 × 365일 / 1억
```

#### 1.5 소음비용 (Valuation of Noise Cost Saving, VONCS)
```
소음도(Leq) = PWL + 10×log₁₀(1/(111.6×(1000×속도/교통량)))
VONCS = 거리 × 소음도 × 2,859원 × 365일 / 1억
```

### 속성 생성
매크로 실행 시 다음 링크 속성들이 자동 생성됩니다:
- @rcl: 도로등급
- @vocs/@pvocs/@nvocs: 차량운행비용 (전체/첨두/비첨두)
- @vots: 시간가치
- @vics: 교통사고비용
- @vopcs/@pvopcs/@nvopcs: 대기오염비용
- @voncs: 소음비용
- @leq1/@leq2: 등가소음도
- @pwl: 음향파워레벨

## 2. +bc-1.mac / +bc-st.mac - 시나리오 실행 매크로

### 기능
- **+bc-1.mac**: 단일 연도 시나리오 분석
- **+bc-st.mac**: 다중 연도 시나리오 분석 (2029-2045)

### 실행 순서
1. 기준 시나리오 복사
2. 프로젝트 시나리오 생성
3. 교통배정 수행 (Pre.mac, volatt-bc.mac)
4. 편익 계산 (ResultBC.mac)
5. 결과 정리 (Benefit.mac)

### 매개변수
- %t1%: 기본 시나리오 번호 (예: 7)
- %t3%: 요금정책 매크로명 (예: Fare30.mac)

## 3. volatt-bc.mac - 교통량/속도 속성 생성

### 기능
교통배정 결과로부터 편익 계산에 필요한 교통량과 속도 속성을 생성합니다.

### 생성 속성
- @ptot: 첨두시간 교통량 (veh/hour)
- @ntot: 비첨두시간 교통량 (veh/hour)  
- @totv: 일교통량 (veh/day)
- @pspd: 첨두시간 속도 (km/h)
- @spd: 평균 속도 (km/h)
- @time: 통행시간 (min)
- @lmark: 분석대상 지역 표시

## 4. ResultBC.mac - 교통배정 및 결과 추출

### 기능
다양한 시나리오에 대해 교통배정을 수행하고 결과를 정리합니다.

### 매개변수
- %1%: 시나리오 번호
- %2%: 매트릭스 번호  
- %3%: 요금정책 매크로

### 실행 과정
1. 다차종 교통배정 (hassign.mac)
2. 첨두/비첨두 시간대별 교통량 계산
3. 속도 및 통행시간 계산
4. 반복 배정을 통한 수렴 달성

## 5. +loopassignment.mac - 반복 교통배정

### 기능
교통배정의 수렴성을 확보하기 위한 반복 배정을 수행합니다.

### 매개변수
- %1%: 시나리오 번호
- %2%: 기존 반복횟수
- %3%: 신규 반복횟수

### 수렴 기준
- 상대갭(Relative Gap): 0.000001
- 정규화갭(Normalized Gap): 0.000001
- 반복횟수: 100회

## 6. 보조 매크로들

### 242c.mac
- 특정 링크를 선택하여 분석 대상으로 표시
- @lmark 속성을 이용한 링크 필터링

### +reflect-all.mac  
- 전체 네트워크에 대한 속성 초기화
- 좌표 기반 전체 네트워크 반영

### (peak)/(npeak)loopassignment.mac
- 첨두시간/비첨두시간 별도 반복 배정
- 시간대별 정밀한 교통배정 수행

## 응용 가이드

### 1. 신규 프로젝트 분석
```
1단계: 기준 시나리오 설정
2단계: 프로젝트 시나리오 생성 
3단계: +bc-st.mac 실행
4단계: 편익 결과 검토
```

### 2. 정책 효과 분석
```
1단계: 현재 정책 시나리오
2단계: 신정책 시나리오  
3단계: +bc-1.mac으로 단년도 분석
4단계: 정책 효과 비교
```

### 3. 민감도 분석
```
1단계: 기본 매개변수 설정
2단계: 매개변수 변경 (시간가치, 사고비용 등)
3단계: Benefit.mac 재실행
4단계: 결과 비교 분석
```

## 주요 공식 요약

| 편익 항목 | 계산 공식 | 단위 |
|-----------|-----------|------|
| VOCS | Σ(속도함수 × 거리 × 교통량 × 차종비율) × 365/억 | 억원/년 |
| VOTS | Σ(시간/60 × 교통량 × 시간가치) × 365/억 | 억원/년 |
| VICS | Σ(사고원단위 × 교통량 × 거리) × 365/억 | 억원/년 |
| VOPCS | Σ(배출함수 × 거리 × 교통량) × 365/억 | 억원/년 |
| VONCS | Σ(거리 × 소음도 × 2859) × 365/억 | 억원/년 |

이러한 매크로들을 통해 교통 프로젝트의 경제성을 체계적이고 정량적으로 평가할 수 있습니다.